#!/usr/bin/env bash
#MISE description="Output cache stats (count and human-readable size)"
#MISE hide=true
#USAGE arg "[dir]" help="Cache directory to scan" default=""
#USAGE arg "[ext]" help="File extension to count" default=""

CACHE_DIR="${usage_dir:-${HOME}/.cache/monkeys/audio}"
EXT="${usage_ext:-wav}"

if [[ ! -d "$CACHE_DIR" ]] || [[ -z "$(ls -A "$CACHE_DIR" 2>/dev/null)" ]]; then
    echo "0 empty"
    exit 0
fi

COUNT=$(ls -1 "$CACHE_DIR"/*."$EXT" 2>/dev/null | wc -l | tr -d ' ')
TOTAL_BYTES=0
for f in "$CACHE_DIR"/*."$EXT"; do
    BYTES=$(stat -f%z "$f" 2>/dev/null || stat -c%s "$f" 2>/dev/null || echo 0)
    TOTAL_BYTES=$((TOTAL_BYTES + BYTES))
done

SIZE=$(mise run --quiet _format-bytes "$TOTAL_BYTES")
echo "$COUNT $SIZE"
