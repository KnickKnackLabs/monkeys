#!/usr/bin/env bash
#MISE description="Welcome message and setup verification"

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"

echo ""
echo "Welcome to monkeys!"
echo ""
echo "CLI for generating media via Hugging Face."
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Commands:"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "  monkeys generate <prompt>   Generate an image from a text prompt"
echo "  monkeys speak <text>        Generate speech from text"
echo "  monkeys listen <file>       Transcribe speech from an audio file"
echo "  monkeys welcome             This message"
echo "  monkeys tasks               List all available tasks"
echo ""
echo "Examples:"
echo ""
echo "  monkeys generate \"a cartoon monkey\""
echo "  monkeys generate \"pixel art sunset\" -o sunset.png"
echo "  monkeys generate \"a cat\" --model stabilityai/stable-diffusion-xl-base-1.0"
echo "  monkeys speak \"Hello world\""
echo "  monkeys speak \"Good morning\" --voice af_bella -o morning.wav"
echo "  monkeys listen recording.wav"
echo "  monkeys listen recording.wav -o transcript.txt"
echo "  monkeys listen --record -d 5"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Setup:"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
if [[ -n "${HF_TOKEN:-}" ]]; then
    echo "  HF_TOKEN: ✓ set (needed for image generation)"
else
    echo "  HF_TOKEN: ✗ not set (needed for image generation)"
    echo "            Get a token at https://huggingface.co/settings/tokens"
fi
echo "  speak:    runs locally, no token needed"
echo "  listen:   runs locally, no token needed (requires ffmpeg)"
echo ""
# Cache stats
AUDIO_STATS=$(mise run --quiet _cache-stats "${HOME}/.cache/monkeys/audio" wav)
AUDIO_COUNT="${AUDIO_STATS%% *}"
AUDIO_SIZE="${AUDIO_STATS#* }"
TRANSCRIPT_STATS=$(mise run --quiet _cache-stats "${HOME}/.cache/monkeys/transcripts" txt)
TRANSCRIPT_COUNT="${TRANSCRIPT_STATS%% *}"
TRANSCRIPT_SIZE="${TRANSCRIPT_STATS#* }"
echo "  Audio cache:       $AUDIO_COUNT entries, $AUDIO_SIZE"
echo "  Transcript cache:  $TRANSCRIPT_COUNT entries, $TRANSCRIPT_SIZE"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "Location: $REPO_DIR"
echo ""
