#!/usr/bin/env bash
#MISE description="Welcome message and setup verification"

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"

echo ""
echo "Welcome to monkeys!"
echo ""
echo "CLI for generating media via Hugging Face."
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Commands:"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "  monkeys generate <prompt>   Generate an image from a text prompt"
echo "  monkeys speak <text>        Generate speech from text"
echo "  monkeys welcome             This message"
echo "  monkeys tasks               List all available tasks"
echo ""
echo "Examples:"
echo ""
echo "  monkeys generate \"a cartoon monkey\""
echo "  monkeys generate \"pixel art sunset\" -o sunset.png"
echo "  monkeys generate \"a cat\" --model stabilityai/stable-diffusion-xl-base-1.0"
echo "  monkeys speak \"Hello world\""
echo "  monkeys speak \"Good morning\" --voice af_bella -o morning.wav"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Setup:"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
if [[ -n "${HF_TOKEN:-}" ]]; then
    echo "  HF_TOKEN: ✓ set (needed for image generation)"
else
    echo "  HF_TOKEN: ✗ not set (needed for image generation)"
    echo "            Get a token at https://huggingface.co/settings/tokens"
fi
echo "  speak:    runs locally, no token needed"
echo ""
# Cache stats
AUDIO_CACHE_DIR="${HOME}/.cache/monkeys/audio"
if [[ -d "$AUDIO_CACHE_DIR" ]] && [[ -n "$(ls -A "$AUDIO_CACHE_DIR" 2>/dev/null)" ]]; then
    CACHE_COUNT=$(ls -1 "$AUDIO_CACHE_DIR"/*.wav 2>/dev/null | wc -l | tr -d ' ')
    CACHE_BYTES=0
    for f in "$AUDIO_CACHE_DIR"/*.wav; do
        BYTES=$(stat -f%z "$f" 2>/dev/null || stat -c%s "$f" 2>/dev/null || echo 0)
        CACHE_BYTES=$((CACHE_BYTES + BYTES))
    done
    CACHE_SIZE=$(mise run --quiet _format-bytes "$CACHE_BYTES")
    echo "  Cache:    $CACHE_COUNT entries, $CACHE_SIZE"
else
    echo "  Cache:    empty"
fi
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "Location: $REPO_DIR"
echo ""
